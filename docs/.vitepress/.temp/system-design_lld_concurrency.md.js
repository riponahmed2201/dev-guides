import { ssrRenderAttrs, ssrRenderStyle } from "vue/server-renderer";
import { useSSRContext } from "vue";
import { _ as _export_sfc } from "./plugin-vue_export-helper.1tPrXgE0.js";
const __pageData = JSON.parse('{"title":"Consistency & Thread Safety","description":"","frontmatter":{},"headers":[],"relativePath":"system-design/lld/concurrency.md","filePath":"system-design/lld/concurrency.md"}');
const _sfc_main = { name: "system-design/lld/concurrency.md" };
function _sfc_ssrRender(_ctx, _push, _parent, _attrs, $props, $setup, $data, $options) {
  _push(`<div${ssrRenderAttrs(_attrs)}><h1 id="consistency-thread-safety" tabindex="-1">Consistency &amp; Thread Safety <a class="header-anchor" href="#consistency-thread-safety" aria-label="Permalink to &quot;Consistency &amp; Thread Safety&quot;">​</a></h1><p>ডিস্ট্রিবিউটেড সিস্টেম এবং মাল্টি-থ্রেডেড অ্যাপ্লিকেশনে ডেটা কনসিস্টেন্সি এবং থ্রেড সেফটি বজায় রাখা অত্যন্ত চ্যালেঞ্জিং। লো-লেভেল ডিজাইনে এটি একটি গুরুত্বপূর্ণ বিষয়।</p><hr><h2 id="১-রেস-কন্ডিশন-কেন-হয়-internal-of-race-conditions" tabindex="-1">১. রেস কন্ডিশন কেন হয়? (Internal of Race Conditions) <a class="header-anchor" href="#১-রেস-কন্ডিশন-কেন-হয়-internal-of-race-conditions" aria-label="Permalink to &quot;১. রেস কন্ডিশন কেন হয়? (Internal of Race Conditions)&quot;">​</a></h2><p>যখন একাধিক থ্রেড একই সময়ে একই মেমরি লোকেশন এক্সেস করে এবং কমপক্ষে একটি থ্রেড ডেটা রাইট (Write) করে, তখন <strong>Race Condition</strong> তৈরি হয়।</p><p><strong>CPU Context Switching-এর ভূমিকা:</strong> CPU একটি থ্রেডকে পুরোপুরি শেষ না করেই অন্য থ্রেডে সুইচ করতে পারে। ধরুন একটি ভ্যারিয়েবল <code>count = 10</code> আছে।</p><ol><li><strong>Thread A:</strong> ভ্যালু রিড করল (১০)।</li><li><strong>Context Switch:</strong> CPU Thread B-তে সুইচ করল।</li><li><strong>Thread B:</strong> ভ্যালু রিড করল (১০), ১ যোগ করল (১১) এবং রাইট করল।</li><li><strong>Thread A:</strong> ফিরে এল, তার কাছে এখনো ভ্যালু ১০ আছে। সে ১ যোগ করল (১১) এবং রাইট করল। <strong>ফলাফল:</strong> দুইবার যোগ করার পর ভ্যালু হওয়ার কথা ছিল ১২, কিন্তু হলো ১১। একেই বলা হয় <strong>Atomic Operation</strong> না হওয়ার সমস্যা।</li></ol><hr><h2 id="২-অ্যাডভান্সড-লকিং-মেকানিজম-advanced-locking" tabindex="-1">২. অ্যাডভান্সড লকিং মেকানিজম (Advanced Locking) <a class="header-anchor" href="#২-অ্যাডভান্সড-লকিং-মেকানিজম-advanced-locking" aria-label="Permalink to &quot;২. অ্যাডভান্সড লকিং মেকানিজম (Advanced Locking)&quot;">​</a></h2><p>শুধু সাধারণ Lock-ই যথেষ্ট নয়, মাঝে মাঝে আরও জটিল লকিং প্রয়োজন হয়:</p><h3 id="ক-reentrant-lock-rlock" tabindex="-1">ক. Reentrant Lock (RLock) <a class="header-anchor" href="#ক-reentrant-lock-rlock" aria-label="Permalink to &quot;ক. Reentrant Lock (RLock)&quot;">​</a></h3><p>সাধারণ Lock একই থ্রেড দুইবার এক্সেস করতে গেলে ডেডলক হয়ে যায়। RLock ব্যবহার করলে একই থ্রেড একাধিকবার লকিং সেশনে প্রবেশ করতে পারে।</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">import</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}"> threading</span></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">lock </span><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">=</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}"> threading.RLock()</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">def</span><span style="${ssrRenderStyle({ "--shiki-light": "#6F42C1", "--shiki-dark": "#B392F0" })}"> nested_call</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">():</span></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">    with</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}"> lock:</span></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#005CC5", "--shiki-dark": "#79B8FF" })}">        print</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">(</span><span style="${ssrRenderStyle({ "--shiki-light": "#032F62", "--shiki-dark": "#9ECBFF" })}">&quot;First lock acquired&quot;</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">)</span></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">        with</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}"> lock:</span></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#005CC5", "--shiki-dark": "#79B8FF" })}">            print</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">(</span><span style="${ssrRenderStyle({ "--shiki-light": "#032F62", "--shiki-dark": "#9ECBFF" })}">&quot;Second lock acquired by same thread&quot;</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">)</span></span></code></pre></div><h3 id="খ-সেমাফোর-semaphore" tabindex="-1">খ. সেমাফোর (Semaphore) <a class="header-anchor" href="#খ-সেমাফোর-semaphore" aria-label="Permalink to &quot;খ. সেমাফোর (Semaphore)&quot;">​</a></h3><p>যখন আপনার রিসোর্স লিমিটেড থাকে (উদা: ডাটাবেস এর মাত্র ৫টি কানেকশন), তখন Semaphore ব্যবহার করা হয়। এটি নির্দিষ্ট সংখ্যাক থ্রেডকে একসাথে কাম করার অনুমতি দেয়।</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">import</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}"> threading</span></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">semaphore </span><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">=</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}"> threading.Semaphore(</span><span style="${ssrRenderStyle({ "--shiki-light": "#005CC5", "--shiki-dark": "#79B8FF" })}">3</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">) </span><span style="${ssrRenderStyle({ "--shiki-light": "#6A737D", "--shiki-dark": "#6A737D" })}"># ৩ জন একসাথে কাজ করতে পারবে</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">def</span><span style="${ssrRenderStyle({ "--shiki-light": "#6F42C1", "--shiki-dark": "#B392F0" })}"> access_resource</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">():</span></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">    with</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}"> semaphore:</span></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#005CC5", "--shiki-dark": "#79B8FF" })}">        print</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">(</span><span style="${ssrRenderStyle({ "--shiki-light": "#032F62", "--shiki-dark": "#9ECBFF" })}">&quot;Working with resource...&quot;</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">)</span></span></code></pre></div><hr><h2 id="৩-ডাবল-চেকড-লকিং-double-checked-locking" tabindex="-1">৩. ডাবল-চেকড লকিং (Double-Checked Locking) <a class="header-anchor" href="#৩-ডাবল-চেকড-লকিং-double-checked-locking" aria-label="Permalink to &quot;৩. ডাবল-চেকড লকিং (Double-Checked Locking)&quot;">​</a></h2><p>এটি একটি পারফরম্যান্স অপ্টিমাইজেশন টেকনিক। লকিং একটি এক্সপেনসিভ অপারেশন, তাই প্রতিবার লকের আগে চেক করা হয় যে সত্যিই লকিং প্রয়োজন কি না।</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">class</span><span style="${ssrRenderStyle({ "--shiki-light": "#6F42C1", "--shiki-dark": "#B392F0" })}"> Database</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">:</span></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">    _instance </span><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">=</span><span style="${ssrRenderStyle({ "--shiki-light": "#005CC5", "--shiki-dark": "#79B8FF" })}"> None</span></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">    _lock </span><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">=</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}"> threading.Lock()</span></span>
<span class="line"></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#6F42C1", "--shiki-dark": "#B392F0" })}">    @</span><span style="${ssrRenderStyle({ "--shiki-light": "#005CC5", "--shiki-dark": "#79B8FF" })}">classmethod</span></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">    def</span><span style="${ssrRenderStyle({ "--shiki-light": "#6F42C1", "--shiki-dark": "#B392F0" })}"> get_instance</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">(cls):</span></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">        if</span><span style="${ssrRenderStyle({ "--shiki-light": "#005CC5", "--shiki-dark": "#79B8FF" })}"> cls</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">._instance </span><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">is</span><span style="${ssrRenderStyle({ "--shiki-light": "#005CC5", "--shiki-dark": "#79B8FF" })}"> None</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">: </span><span style="${ssrRenderStyle({ "--shiki-light": "#6A737D", "--shiki-dark": "#6A737D" })}"># ১ম চেক</span></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">            with</span><span style="${ssrRenderStyle({ "--shiki-light": "#005CC5", "--shiki-dark": "#79B8FF" })}"> cls</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">._lock:</span></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">                if</span><span style="${ssrRenderStyle({ "--shiki-light": "#005CC5", "--shiki-dark": "#79B8FF" })}"> cls</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">._instance </span><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">is</span><span style="${ssrRenderStyle({ "--shiki-light": "#005CC5", "--shiki-dark": "#79B8FF" })}"> None</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">: </span><span style="${ssrRenderStyle({ "--shiki-light": "#6A737D", "--shiki-dark": "#6A737D" })}"># ২য় চেক</span></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#005CC5", "--shiki-dark": "#79B8FF" })}">                    cls</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">._instance </span><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">=</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}"> Database()</span></span>
<span class="line"><span style="${ssrRenderStyle({ "--shiki-light": "#D73A49", "--shiki-dark": "#F97583" })}">        return</span><span style="${ssrRenderStyle({ "--shiki-light": "#005CC5", "--shiki-dark": "#79B8FF" })}"> cls</span><span style="${ssrRenderStyle({ "--shiki-light": "#24292E", "--shiki-dark": "#E1E4E8" })}">._instance</span></span></code></pre></div><hr><h2 id="৪-ডেডলক-প্রতিরোধ-deadlock-prevention" tabindex="-1">৪. ডেডলক প্রতিরোধ (Deadlock Prevention) <a class="header-anchor" href="#৪-ডেডলক-প্রতিরোধ-deadlock-prevention" aria-label="Permalink to &quot;৪. ডেডলক প্রতিরোধ (Deadlock Prevention)&quot;">​</a></h2><p>ডেডলক হয় যখন ৪টি শর্ত পূরণ হয় (Coffman Conditions): Mutual Exclusion, Hold and Wait, No Preemption, এবং Circular Wait।</p><p><strong>প্রতিরোধের উপায়:</strong></p><ul><li><strong>Lock Ordering:</strong> সবসময় একই অর্ডারে লক করা (উদা: আগে Lock A তারপর Lock B)।</li><li><strong>Lock Timeout:</strong> অনন্তকাল অপেক্ষা না করে একটি নির্দিষ্ট সময় পর রিকোয়েস্ট ক্যানসেল করা।</li><li><strong>Avoid Nested Locks:</strong> যতটা সম্ভব নেস্টেড লক এড়িয়ে চলা।</li></ul><hr><h2 id="৫-প্রোডিউসার-কনজিউমার-এবং-কন্ডিশন-ভ্যারিয়েবল" tabindex="-1">৫. প্রোডিউসার-কনজিউমার এবং কন্ডিশন ভ্যারিয়েবল <a class="header-anchor" href="#৫-প্রোডিউসার-কনজিউমার-এবং-কন্ডিশন-ভ্যারিয়েবল" aria-label="Permalink to &quot;৫. প্রোডিউসার-কনজিউমার এবং কন্ডিশন ভ্যারিয়েবল&quot;">​</a></h2><p>বাফার ফুল (Full) থাকলে প্রোডিউসার ওয়েট করবে এবং বাফার খালি (Empty) থাকলে কনজিউমার ওয়েট করবে। পাইথনে <code>queue.Queue</code> এটি ইন্টারনালি হ্যান্ডেল করে, কিন্তু কাস্টম লজিকে <code>threading.Condition</code> ব্যবহার করা হয়।</p><hr><div class="caution custom-block github-alert"><p class="custom-block-title">CAUTION</p><p><strong>Over-synchronization:</strong> সব জায়গায় লক ব্যবহার করলে পারফরম্যান্স মারাত্মকভাবে কমে যেতে পারে এবং সিস্টেম স্লো হয়ে যেতে পারে। তাই যেখানে প্রয়োজন সেখানেই সঠিকভাবে লকিং ব্যবহার করুন।</p></div></div>`);
}
const _sfc_setup = _sfc_main.setup;
_sfc_main.setup = (props, ctx) => {
  const ssrContext = useSSRContext();
  (ssrContext.modules || (ssrContext.modules = /* @__PURE__ */ new Set())).add("system-design/lld/concurrency.md");
  return _sfc_setup ? _sfc_setup(props, ctx) : void 0;
};
const concurrency = /* @__PURE__ */ _export_sfc(_sfc_main, [["ssrRender", _sfc_ssrRender]]);
export {
  __pageData,
  concurrency as default
};
