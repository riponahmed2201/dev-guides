# USER Instruction ЁЯСд

Dockerfile-ржП **USER** ржЗржирзНрж╕ржЯрзНрж░рж╛ржХрж╢ржиржЯрж┐ ржХржирзНржЯрзЗржЗржирж╛рж░рзЗрж░ рж╕рзБрж░ржХрзНрж╖рж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рж╛рж░ ржЬржирзНржп ржЕрждрзНржпржирзНржд ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржгред ржПржЯрж┐ рж╕рж░рж╛рж╕рж░рж┐ ржХржирзНржЯрзЗржЗржирж╛рж░рзЗрж░ ржнрзЗрждрж░рзЗ рж░рж╛ржи рж╣ржУрзЯрж╛ ржкрзНрж░рж╕рзЗрж╕ржЧрзБрж▓рзЛ ржХрзЛржи ржЗржЙржЬрж╛рж░ рж╣рж┐рж╕рзЗржмрзЗ рж░рж╛ржи ржХрж░ржмрзЗ рждрж╛ ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рзЗред

---

## рзз. USER ржЗржирзНрж╕ржЯрзНрж░рж╛ржХрж╢ржи ржХрж┐?

ржбрж┐ржлрж▓рзНржЯржнрж╛ржмрзЗ, ржбржХрж╛рж░ ржХржирзНржЯрзЗржЗржирж╛рж░рзЗрж░ рж╕ржм ржХржорж╛ржирзНржб **root** ржЗржЙржЬрж╛рж░ рж╣рж┐рж╕рзЗржмрзЗ ржЪрж▓рзЗред ржХрж┐ржирзНрждрзБ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ ржмрзЗрж╕рзНржЯ ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕ ржЕржирзБржпрж╛рзЯрзА, ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржиржЯрж┐ рж░рзБржЯ ржЗржЙржЬрж╛рж░ рж╣рж┐рж╕рзЗржмрзЗ ржЪрж╛рж▓рж╛ржирзЛ ржЙржЪрж┐ржд ржирзЯред `USER` ржЗржирзНрж╕ржЯрзНрж░рж╛ржХрж╢ржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЖржкржирж┐ ржХржирзНржЯрзЗржЗржирж╛рж░рзЗрж░ ржХржирзНржЯрзЗржХрзНрж╕ржЯ рж░рзБржЯ ржерзЗржХрзЗ ржЕржирзНржп ржХрзЛржирзЛ рж╕рж╛ржзрж╛рж░ржг ржЗржЙржЬрж╛рж░рзЗ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

---

## рзи. рж░рзБржЯ ржЗржЙржЬрж╛рж░ рж╣рж┐рж╕рзЗржмрзЗ ржЪрж╛рж▓рж╛ржирзЛрж░ ржЭрзБржБржХрж┐

ржпржжрж┐ ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржиржЯрж┐ рж░рзБржЯ ржЗржЙржЬрж╛рж░ рж╣рж┐рж╕рзЗржмрзЗ ржЪрж▓рзЗ ржПржмржВ ржХрзЛржирзЛржнрж╛ржмрзЗ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржиржЯрж┐рждрзЗ рж╣рзНржпрж╛ржХрж╛рж░рж░рж╛ ржПржХрзНрж╕рзЗрж╕ ржкрж╛рзЯ, рждржмрзЗ:

- рж╣рзНржпрж╛ржХрж╛рж░ ржХржирзНржЯрзЗржЗржирж╛рж░рзЗрж░ рж╕ржм ржлрж╛ржЗрж▓ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗред
- ржХржирзНржЯрзЗржЗржирж╛рж░ ржерзЗржХрзЗ ржмрзЗрж░ рж╣рзЯрзЗ ржорзЗржЗржи рж╣рзЛрж╕рзНржЯ рж╕рж┐рж╕рзНржЯрзЗржорзЗрж░ ржирж┐рзЯржирзНрждрзНрж░ржг ржирзЗржУрзЯрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ (Container Breakout)ред
- рж╕рзЗржирж╕рж┐ржЯрж┐ржн ржбрзЗржЯрж╛ ржЪрзБрж░рж┐ рж╣ржУрзЯрж╛рж░ ржЭрзБржБржХрж┐ рззрзжрзж% ржмрзЗрзЬрзЗ ржпрж╛рзЯред

---

## рзй. ржХрж┐ржнрж╛ржмрзЗ USER ржЗржирзНрж╕ржЯрзНрж░рж╛ржХрж╢ржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи?

ржкрзНрж░ржержорзЗ ржЖржкржирж╛ржХрзЗ ржПржХржЯрж┐ ржирждрзБржи ржЗржЙржЬрж╛рж░ ржПржмржВ ржЧрзНрж░рзБржк рждрзИрж░рж┐ ржХрж░рждрзЗ рж╣ржмрзЗ ржПржмржВ рждрж╛рж░ржкрж░ `USER` ржХржорж╛ржирзНржб ржжрж┐рзЯрзЗ рж╕рзЗржЯрж┐ рж╕рзЗржЯ ржХрж░рждрзЗ рж╣ржмрзЗред

### Alpine Linux-ржПрж░ ржЬржирзНржп ржЙржжрж╛рж╣рж░ржг:

```dockerfile
# рзз. ржПржХржЯрж┐ ржиржи-рж░рзБржЯ ржЗржЙржЬрж╛рж░ ржПржмржВ ржЧрзНрж░рзБржк рждрзИрж░рж┐ ржХрж░рж╛
RUN addgroup -S appgroup && adduser -S appuser -G appgroup

# рзи. ржХрж╛ржЬрзЗрж░ ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ рж╕рзЗржЯ ржХрж░рж╛
WORKDIR /app

# рзй. ржлрж╛ржЗрж▓рзЗрж░ ржкрж╛рж░ржорж┐рж╢ржи ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж╛ (ржпрж╛рждрзЗ ржирждрзБржи ржЗржЙржЬрж╛рж░ ржлрж╛ржЗрж▓ ржкрзЬрждрзЗ/рж▓рж┐ржЦрждрзЗ ржкрж╛рж░рзЗ)
COPY --chown=appuser:appgroup . .

# рзк. ржЗржЙржЬрж╛рж░ рж╕рзБржЗржЪ ржХрж░рж╛
USER appuser

# ржПржЦржи ржерзЗржХрзЗ рж╕ржмржХрж┐ржЫрзБ appuser рж╣рж┐рж╕рзЗржмрзЗ ржЪрж▓ржмрзЗ
CMD ["npm", "start"]
```

### Ubuntu/Debian-ржПрж░ ржЬржирзНржп ржЙржжрж╛рж╣рж░ржг:

```dockerfile
RUN groupadd -r appgroup && useradd -r -g appgroup appuser
USER appuser
```

---

## рзк. ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржЯрж┐ржкрж╕

- **Specific UID/GID ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛:** ржЕржирзЗржХ рж╕ржорзЯ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ ржкрж▓рж┐рж╕рж┐рж░ ржЬржирзНржп ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржЖржЗржбрж┐ ржкрзНрж░рзЯрзЛржЬржи рж╣рзЯред
  ```dockerfile
  RUN addgroup -g 1001 appgroup && \
      adduser -D -u 1001 -G appgroup appuser
  USER appuser
  ```
- **--chown ржлрзНрж▓рж╛ржЧ:** `COPY` ржмрж╛ `ADD` ржХржорж╛ржирзНржбрзЗрж░ рж╕ржорзЯ рж░рж┐ржорзЗржорзНржмрж╛рж░ ржХрж░рзЗ `--chown=user:group` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи, ржирждрзБржмрж╛ ржлрж╛ржЗрж▓ржЧрзБрж▓рзЛ рж░рзБржЯ ржЗржЙржЬрж╛рж░рзЗрж░ ржорж╛рж▓рж┐ржХрж╛ржирж╛ржзрзАржи ржерзЗржХрзЗ ржпрж╛ржмрзЗ ржПржмржВ ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржк рж╕рзЗржЧрзБрж▓рзЛ ржПржХрзНрж╕рзЗрж╕ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ ржирж╛ред
- **WORKDIR ржПрж░ ржЕржмрж╕рзНржерж╛ржи:** рж╕рж╛ржзрж╛рж░ржгржд ржЗржЙржЬрж╛рж░ рж╕рзБржЗржЪ ржХрж░рж╛рж░ ржЖржЧрзЗржЗ `WORKDIR` рж╕рзЗржЯ ржХрж░рж╛ ржПржмржВ ржкрзНрж░рзЯрзЛржЬржирзАрзЯ ржлрж╛ржЗрж▓ ржХржкрж┐ ржХрж░рж╛ рж╢рзЗрж╖ ржХрж░рж╛ ржнрж╛рж▓рзЛред

---

## рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк (Summary)

ржкрзНрж░рзЛржбрж╛ржХрж╢ржи-рж░рзЗржбрж┐ ржпрзЗржХрзЛржирзЛ Dockerfile-ржП `USER` ржЗржирзНрж╕ржЯрзНрж░рж╛ржХрж╢ржи ржерж╛ржХрж╛ ржмрж╛ржзрзНржпрждрж╛ржорзВрж▓ржХ ржмрж▓рзЗ ржоржирзЗ ржХрж░рж╛ рж╣рзЯред ржПржЯрж┐ ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржЪрж╛рж░ржзрж╛рж░рзЗ ржПржХржЯрж┐ ржЕрждрж┐рж░рж┐ржХрзНржд ржирж┐рж░рж╛ржкрждрзНрждрж╛рж░ рж╕рзНрждрж░ рждрзИрж░рж┐ ржХрж░рзЗред

---

> [!IMPORTANT]
> рж╕ржмрж╕ржорзЯ ржоржирзЗ рж░рж╛ржЦржмрзЗржи: "Principle of Least Privilege" ржмрж╛ ржирзНржпрзВржирждржо ржХрзНрж╖ржорждрж╛рж░ ржирзАрждрж┐ ржЕржирзБржпрж╛рзЯрзА ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи рж░рж╛ржи ржХрж░рж╛ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐рж░ ржорзВрж▓ ржЪрж╛ржмрж┐ржХрж╛ржарж┐ред
