# Dockerfile Best Practices ЁЯЪА

ржПржХржЯрж┐ ржжржХрзНрж╖ (Efficient), рж╕рзБрж░ржХрзНрж╖рж┐ржд (Secure) ржПржмржВ ржЫрзЛржЯ рж╕рж╛ржЗржЬрзЗрж░ ржХржирзНржЯрзЗржЗржирж╛рж░ ржЗржорзЗржЬ рждрзИрж░рж┐ ржХрж░рж╛рж░ ржЬржирзНржп Dockerfile-ржПрж░ ржХрж┐ржЫрзБ ржмрзЗрж╕рзНржЯ ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕ ржорзЗржирзЗ ржЪрж▓рж╛ ржЕржкрж░рж┐рж╣рж╛рж░рзНржпред ржПржЗ ржЧрж╛ржЗржбрзЗ ржЖржорж░рж╛ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи-рж░рзЗржбрж┐ ржЗржорзЗржЬ рждрзИрж░рж┐рж░ ржорзВрж▓ ржоржирзНрждрзНрж░ржЧрзБрж▓рзЛ рж╢рж┐ржЦржмрзЛред

---

## рзз. рж▓рзЗржпрж╝рж╛рж░ рж╕ржВржЦрзНржпрж╛ ржХржорж╛ржирзЛ (Minimize Layers)

Dockerfile-ржПрж░ ржкрзНрж░рждрж┐ржЯрж┐ `RUN`, `COPY`, ржПржмржВ `ADD` ржЗржирзНрж╕ржЯрзНрж░рж╛ржХрж╢ржи ржирждрзБржи ржПржХржЯрж┐ рж▓рзЗржпрж╝рж╛рж░ рждрзИрж░рж┐ ржХрж░рзЗред ржпржд ржмрзЗрж╢рж┐ рж▓рзЗржпрж╝рж╛рж░, ржЗржорзЗржЬрзЗрж░ рж╕рж╛ржЗржЬ рждржд ржмрзЬ рж╣рзЯред

- **ржнрзБрж▓ ржкржжрзНржзрждрж┐:**
  ```dockerfile
  RUN apt-get update
  RUN apt-get install -y git
  RUN apt-get install -y curl
  ```
- **рж╕ржарж┐ржХ ржкржжрзНржзрждрж┐:** ржПржХрж╛ржзрж┐ржХ ржХржорж╛ржирзНржбржХрзЗ `&&` ржжрж┐рзЯрзЗ ржпрзБржХрзНржд ржХрж░рзБржиред
  ```dockerfile
  RUN apt-get update && apt-get install -y \
      git \
      curl \
      && rm -rf /var/lib/apt/lists/*
  ```

---

## рзи. .dockerignore ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛

ржмрж┐рж▓рзНржб ржХржирзНржЯрзЗржХрзНрж╕ржЯ (Build Context) ржерзЗржХрзЗ ржЕржкрзНрж░рзЯрзЛржЬржирзАржпрж╝ ржлрж╛ржЗрж▓ (ржпрзЗржоржи: `node_modules`, `.git`, рж▓рзЛржЧ ржлрж╛ржЗрж▓) ржмрж╛ржж ржжрзЗржУрзЯрж╛рж░ ржЬржирзНржп `.dockerignore` ржлрж╛ржЗрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред ржПржЯрж┐ ржмрж┐рж▓рзНржб ржкрзНрж░рж╕рзЗрж╕ ржжрзНрж░рзБржд ржХрж░рзЗ ржПржмржВ ржЗржорзЗржЬ рж╕рж╛ржЗржЬ ржХржорж╛ржпрж╝ред

**ржЙржжрж╛рж╣рж░ржг `.dockerignore`:**

```text
node_modules
.git
*.log
dist
```

---

## рзй. ржЗржирзНрж╕ржЯрзНрж░рж╛ржХрж╢ржирзЗрж░ ржХрзНрж░ржорж╛ржирзБрж╕рж░ржг (Order Matters)

ржбржХрж╛рж░ ржмрж┐рж▓рзНржб ржХрж░рж╛рж░ рж╕ржорзЯ рж▓рзЗржпрж╝рж╛рж░ ржХрзНржпрж╛рж╢рж┐ржВ (Caching) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред ржпрзЗ ржлрж╛ржЗрж▓ржЧрзБрж▓рзЛ ржШржиржШржи ржкрж░рж┐ржмрж░рзНрждржи рж╣рзЯ (ржпрзЗржоржи: Source Code), рж╕рзЗржЧрзБрж▓рзЛ Dockerfile-ржПрж░ ржирж┐ржЪрзЗрж░ ржжрж┐ржХрзЗ рж░рж╛ржЦрж╛ ржЙржЪрж┐рждред ржЖрж░ ржпрзЗржЧрзБрж▓рзЛ ржкрж░рж┐ржмрж░рзНрждржи рж╣рзЯ ржирж╛ (ржпрзЗржоржи: Dependency install), рж╕рзЗржЧрзБрж▓рзЛ ржЙржкрж░рзЗрж░ ржжрж┐ржХрзЗ рж░рж╛ржЦрж╛ ржнрж╛рж▓рзЛред

```dockerfile
# ржнрж╛рж▓рзЛ ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕: ржЖржЧрзЗ ржбрж┐ржкрзЗржирзНржбрзЗржирзНрж╕рж┐ ржЗржирзНрж╕ржЯрж▓ ржХрж░рж╛
COPY package.json .
RUN npm install

# ржкрж░рзЗ рж╕рзЛрж░рзНрж╕ ржХрзЛржб ржХржкрж┐ ржХрж░рж╛
COPY . .
```

---

## рзк. ржорж╛рж▓рзНржЯрж┐-рж╕рзНржЯрзЗржЬ ржмрж┐рж▓рзНржб (Multi-stage Builds)

ржПржЯрж┐ ржЗржорзЗржЬ рж╕рж╛ржЗржЬ ржХржорж╛ржирзЛрж░ рж╕ржмржЪрзЗрзЯрзЗ ржХрж╛рж░рзНржпржХрж░ ржЙржкрж╛рзЯред ржПржХржЯрж┐ рж╕рзНржЯрзЗржЬрзЗ ржмрж┐рж▓рзНржб ржХрж░рзЗ ржЕржирзНржп рж╕рзНржЯрзЗржЬрзЗ рж╢рзБржзрзБ ржкрзНрж░рзЯрзЛржЬржирзАрзЯ ржлрж╛ржЗрж▓ржЧрзБрж▓рзЛ ржХржкрж┐ ржХрж░рзЗ ржирзЗржУрзЯрж╛ рж╣рзЯред

```dockerfile
# рж╕рзНржЯрзЗржЬ рзз: ржмрж┐рж▓рзНржб
FROM node:18 AS builder
WORKDIR /app
COPY . .
RUN npm run build

# рж╕рзНржЯрзЗржЬ рзи: рж░рж╛ржиржЯрж╛ржЗржо (ржЦрзБржмржЗ ржЫрзЛржЯ ржЗржорзЗржЬ)
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
```

---

## рзл. рж░рзБржЯ ржЗржЙржЬрж╛рж░ ржПрзЬрж┐рзЯрзЗ ржЪрж▓рж╛ (Don't run as root)

ржирж┐рж░рж╛ржкрждрзНрждрж╛рж░ ржЦрж╛рждрж┐рж░рзЗ ржХржирзНржЯрзЗржЗржирж╛рж░рзЗрж░ ржнрзЗрждрж░рзЗ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржиржЯрж┐ рж░рзБржЯ ржЗржЙржЬрж╛рж░ рж╣рж┐рж╕рзЗржмрзЗ ржирж╛ ржЪрж╛рж▓рж╛ржирзЛржЗ ржнрж╛рж▓рзЛред ржПрж░ ржкрж░рж┐ржмрж░рзНрждрзЗ ржПржХржЯрж┐ ржХрж╛рж╕рзНржЯржо ржЗржЙржЬрж╛рж░ рждрзИрж░рж┐ ржХрж░рзЗ рж╕рзЗржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред

```dockerfile
RUN addgroup -S appgroup && adduser -S appuser -G appgroup
USER appuser
```

---

## рзм. ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржЯрзНржпрж╛ржЧ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ (Use Specific Tags)

рж╕ржмрж╕ржорзЯ ржмрзЗрж╕ ржЗржорзЗржЬрзЗрж░ ржПржХржЯрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржнрж╛рж░рзНрж╕ржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред `latest` ржЯрзНржпрж╛ржЧ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ ржнржмрж┐рж╖рзНржпрждрзЗ ржмрж┐рж▓рзНржбрзЗ рж╕ржорж╕рзНржпрж╛ рж╣рждрзЗ ржкрж╛рж░рзЗред

- **ржмрж░рзНржЬржи ржХрж░рзБржи:** `FROM node:latest`
- **ржЧрзНрж░рж╣ржг ржХрж░рзБржи:** `FROM node:18-alpine`

---

## рзн. COPY ржмржирж╛ржо ADD

ржлрж╛ржЗрж▓ ржХржкрж┐ ржХрж░рж╛рж░ ржЬржирзНржп рж╕ржмрж╕ржорзЯ `COPY` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред `ADD` рж╢рзБржзрзБржорж╛рждрзНрж░ рждржЦржиржЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи ржпржЦржи ржЖржкржирж╛рж░ ржХрзЛржирзЛ URL ржерзЗржХрзЗ ржлрж╛ржЗрж▓ ржбрж╛ржЙржирж▓рзЛржб ржХрж░рж╛ ржмрж╛ ржЬрж┐ржк ржлрж╛ржЗрж▓ ржПржХрзНрж╕ржЯрзНрж░рж╛ржХрзНржЯ ржХрж░рж╛ ржкрзНрж░рзЯрзЛржЬржиред `COPY` ржЕржирзЗржХ ржмрзЗрж╢рж┐ рж╕рзНржмржЪрзНржЫ ржПржмржВ ржирж┐рж░рж╛ржкржжред

---

## рзо. ржЫрзЛржЯ ржмрзЗрж╕ ржЗржорзЗржЬ ржирж┐рж░рзНржмрж╛ржЪржи (Small Base Images)

ржЗржорзЗржЬрзЗрж░ рж╕рж╛ржЗржЬ ржЫрзЛржЯ рж░рж╛ржЦрждрзЗ `alpine` ржмрж╛ `slim` ржнрж╛рж░рзНрж╕ржиржЧрзБрж▓рзЛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред ржПржЧрзБрж▓рзЛ рж╕рж╛ржзрж╛рж░ржгржд рзл-рззрзж MB рж╣ржпрж╝, ржпрзЗржЦрж╛ржирзЗ рж╕рж╛ржзрж╛рж░ржг ржЗржорзЗржЬ рж╢ржд рж╢ржд ржорзЗржЧрж╛ржмрж╛ржЗржЯ рж╣рждрзЗ ржкрж╛рж░рзЗред

---

## рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк (Quick Checklist)

- [x] рж▓рзЗржпрж╝рж╛рж░ рж╕ржВржЦрзНржпрж╛ ржХржорж╛ржирзЛрж░ ржЬржирзНржп ржХржорж╛ржирзНржб ржХржорзНржмрж╛ржЗржи ржХрж░рж╛ред
- [x] ржЕржкрзНрж░рзЯрзЛржЬржирзАржпрж╝ ржлрж╛ржЗрж▓ ржбрж┐рж▓рж┐ржЯ ржХрж░рж╛ (ржПржХржЗ рж▓рзЗржпрж╝рж╛рж░рзЗ)ред
- [x] `.dockerignore` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ред
- [x] ржорж╛рж▓рзНржЯрж┐-рж╕рзНржЯрзЗржЬ ржмрж┐рж▓рзНржб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ред
- [x] ржиржи-рж░рзБржЯ ржЗржЙржЬрж╛рж░ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ред

---

> [!IMPORTANT]
> ржоржирзЗ рж░рж╛ржЦржмрзЗржи, ржЫрзЛржЯ ржЗржорзЗржЬ ржорж╛ржирзЗржЗ ржжрзНрж░рзБржд ржбрж┐ржкрзНрж▓рзЯржорзЗржирзНржЯ ржПржмржВ ржХржо рж╕рзНржЯрзЛрж░рзЗржЬ ржЦрж░ржЪ!
