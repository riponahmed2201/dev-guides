# Docker Health Checks ЁЯПе

ржбржХрж╛рж░ ржХржирзНржЯрзЗржЗржирж╛рж░ ржЪрж▓ржЫрзЗ (Running) ржорж╛ржирзЗржЗ ржПржЗ ржирзЯ ржпрзЗ ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржиржЯрж┐ рж╕ржарж┐ржХржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░ржЫрзЗред ржПржХржЯрж┐ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи рж╣рзНржпрж╛ржВ рж╣рзЯрзЗ ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗ ржмрж╛ ржЗржирзНржЯрж╛рж░ржирж╛рж▓ ржПрж░рж░рзЗрж░ ржХрж╛рж░ржгрзЗ рж░рзЗрж╕ржкржирзНрж╕ ржирж╛ржУ ржХрж░рждрзЗ ржкрж╛рж░рзЗред ржПржЗ ржЕржмрж╕рзНржерж╛ рж╢ржирж╛ржХрзНржд ржХрж░рж╛рж░ ржЬржирзНржпржЗ **Health Checks** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯред

---

## рзз. Health Check ржХрж┐?

Health Check рж╣рж▓рзЛ ржПржХржЯрж┐ ржорзЗржХрж╛ржирж┐ржЬржо ржпрж╛рж░ ржорж╛ржзрзНржпржорзЗ ржбржХрж╛рж░ ржЗржЮрзНржЬрж┐ржи ржирж┐рзЯржорж┐ржд ржмрж┐рж░рждрж┐рждрзЗ ржХржирзНржЯрзЗржЗржирж╛рж░рзЗрж░ ржнрзЗрждрж░рзЗ ржПржХржЯрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХржорж╛ржирзНржб рж░рж╛ржи ржХрж░рзЗ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзЗ ржжрзЗржЦрзЗ ржпрзЗ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржиржЯрж┐ рж╕рзБрж╕рзНрже (Healthy) ржЖржЫрзЗ ржХрж┐ржирж╛ред

ржХржирзНржЯрзЗржЗржирж╛рж░рзЗрж░ рждрж┐ржиржЯрж┐ ржЕржмрж╕рзНржерж╛ рж╣рждрзЗ ржкрж╛рж░рзЗ:
- **Starting:** ржХржирзНржЯрзЗржЗржирж╛рж░ рж╢рзБрж░рзБ рж╣ржЪрзНржЫрзЗ ржХрж┐ржирзНрждрзБ ржПржЦржирзЛ рж╣рзЗрж▓рже ржЪрзЗржХ рж╢рзЗрж╖ рж╣рзЯржирж┐ред
- **Healthy:** ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржиржЯрж┐ ржарж┐ржХржорждрзЛ ржХрж╛ржЬ ржХрж░ржЫрзЗред
- **Unhealthy:** ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржиржЯрж┐ рж░рзЗрж╕ржкржирзНрж╕ ржХрж░ржЫрзЗ ржирж╛ ржмрж╛ ржПрж░рж░ ржжрж┐ржЪрзНржЫрзЗред

---

## рзи. Dockerfile-ржП HEALTHCHECK ржЗржирзНрж╕ржЯрзНрж░рж╛ржХрж╢ржи

ржЖржкржирж┐ Dockerfile-ржП `HEALTHCHECK` ржХржорж╛ржирзНржб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж╣рзЗрж▓рже ржЪрзЗржХ ржбрж┐ржлрж╛ржЗржи ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

```dockerfile
# ржкрзНрж░рждрж┐ рзйрзж рж╕рзЗржХрзЗржирзНржб ржкрж░ ржкрж░ ржЪрзЗржХ ржХрж░ржмрзЗ
# рзй рж╕рзЗржХрзЗржирзНржбрзЗрж░ ржоржзрзНржпрзЗ рж░рзЗрж╕ржкржирзНрж╕ ржирж╛ ржкрзЗрж▓рзЗ ржлрзЗржЗрж▓ ржзрж░ржмрзЗ
# ржЯрж╛ржирж╛ рзй ржмрж╛рж░ ржлрзЗржЗрж▓ ржХрж░рж▓рзЗ ржХржирзНржЯрзЗржЗржирж╛рж░ржХрзЗ Unhealthy ржШрзЛрж╖ржгрж╛ ржХрж░ржмрзЗ
HEALTHCHECK --interval=30s --timeout=3s --retries=3 \
  CMD curl -f http://localhost/ || exit 1
```

- `--interval`: ржХржд рж╕ржорзЯ ржкрж░ржкрж░ ржЪрзЗржХ ржХрж░ржмрзЗ (Default: 30s)ред
- `--timeout`: ржХржорж╛ржирзНржбржЯрж┐ рж╢рзЗрж╖ рж╣рждрзЗ рж╕рж░рзНржмрзЛржЪрзНржЪ ржХржд рж╕ржорзЯ ржирзЗржмрзЗ (Default: 30s)ред
- `--retries`: ржХрждржмрж╛рж░ ржлрзЗржЗрж▓ ржХрж░рж▓рзЗ Unhealthy ржзрж░рж╛ рж╣ржмрзЗ (Default: 3).
- `--start-period`: ржХржирзНржЯрзЗржЗржирж╛рж░ рж╢рзБрж░рзБ рж╣ржУрзЯрж╛рж░ ржкрж░ ржХрждржХрзНрж╖ржг рж╣рзЗрж▓рже ржЪрзЗржХ ржмржирзНржз ржерж╛ржХржмрзЗ (ржпрж╛рждрзЗ ржЕрзНржпрж╛ржк ржмрзБржЯ рж╣ржУрзЯрж╛рж░ рж╕ржорзЯ ржкрж╛рзЯ)ред

---

## рзй. Docker Compose-ржП Health Check

ржбржХрж╛рж░ ржХржорзНржкрзЛржЬ ржлрж╛ржЗрж▓рзЗ ржЖржкржирж┐ ржЖрж░ржУ рж╕рж╣ржЬрзЗ рж╣рзЗрж▓рже ржЪрзЗржХ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи:

```yaml
services:
  web:
    image: my-web-app
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    restart: always
```

---

## рзк. ржХрзЗржи Health Check ржкрзНрж░рзЯрзЛржЬржи?

1. **Self-Healing:** ржпржжрж┐ ржХрзЛржирзЛ ржХржирзНржЯрзЗржЗржирж╛рж░ `Unhealthy` рж╣рзЯрзЗ ржпрж╛рзЯ, рждржмрзЗ ржбржХрж╛рж░ (ржмрж╛ ржЕрж░рзНржХрзЗрж╕рзНржЯрзНрж░рзЗржЯрж░ ржпрзЗржоржи Swarm/K8s) рж╕рзЗржЯрж┐ржХрзЗ ржЕржЯрзЛржорзЗржЯрж┐ржХ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рждрзЗ ржкрж╛рж░рзЗред
2. **Load Balancer Integration:** рж▓рзЛржб ржмрзНржпрж╛рж▓рзЗржирзНрж╕рж╛рж░ рж╢рзБржзрзБржорж╛рждрзНрж░ `Healthy` ржХржирзНржЯрзЗржЗржирж╛рж░ржЧрзБрж▓рзЛрждрзЗ ржЯрзНрж░рж╛ржлрж┐ржХ ржкрж╛ржарж╛ржмрзЗред ржпржжрж┐ ржХрзЛржирзЛ ржХржирзНржЯрзЗржЗржирж╛рж░ ржбрж╛ржЙржи ржерж╛ржХрзЗ, рждржмрзЗ ржЗржЙржЬрж╛рж░ рж╕рзЗржЯрж┐ ржЯрзЗрж░ ржкрж╛ржмрзЗ ржирж╛ред
3. **Zero-Downtime Deployment:** ржЖржкржбрзЗржЯ ржжрзЗржУрзЯрж╛рж░ рж╕ржорзЯ ржирждрзБржи ржХржирзНржЯрзЗржЗржирж╛рж░ ржкрзБрж░рзЛржкрзБрж░рж┐ `Healthy` ржирж╛ рж╣ржУрзЯрж╛ ржкрж░рзНржпржирзНржд ржкрзБрж░ржирзЛ ржХржирзНржЯрзЗржЗржирж╛рж░ ржмржирзНржз ржХрж░рж╛ рж╣рзЯ ржирж╛ред

---

## рзл. ржмрзЗрж╕рзНржЯ ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕ (Best Practices)

- **рж╕ржарж┐ржХ ржХржорж╛ржирзНржб ржирж┐рж░рзНржмрж╛ржЪржи:** рж╢рзБржзрзБржорж╛рждрзНрж░ `curl` ржирзЯ, ржкрзНрж░рзЯрзЛржЬржи рж╣рж▓рзЗ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржХрж╛ржирзЗржХрж╢ржи ржмрж╛ рж╕рзНржкрзЗрж╕рж┐ржлрж┐ржХ рж╣рзЗрж▓рже ржПржирзНржбржкрзЯрзЗржирзНржЯ (`/health`) ржЪрзЗржХ ржХрж░рзБржиред
- **рж░рж┐рж╕рзЛрж░рзНрж╕ рж╕ржЪрзЗрждржирждрж╛:** рж╣рзЗрж▓рже ржЪрзЗржХ ржХржорж╛ржирзНржб ржпрзЗржи ржЦрзБржм ржмрзЗрж╢рж┐ рж╣рзЗржнрж┐ (Heavy) ржирж╛ рж╣рзЯ, ржХрж╛рж░ржг ржПржЯрж┐ ржШржиржШржи рж░рж╛ржи рж╣рзЯред
- **exit ржХрзЛржб:** ржХржорж╛ржирзНржбржЯрж┐ рж╕ржлрж▓ рж╣рж▓рзЗ `exit 0` ржПржмржВ ржмрзНржпрж░рзНрже рж╣рж▓рзЗ `exit 1` рж░рж┐ржЯрж╛рж░рзНржи ржХрж░рждрзЗ рж╣ржмрзЗред

---

## рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк (Summary)
ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржПржиржнрж╛ржпрж╝рж░ржиржорзЗржирзНржЯрзЗ рж╣рж╛ржЗ-ржЕрзНржпрж╛ржнрзЗржЗрж▓рзЗржмрж┐рж▓рж┐ржЯрж┐ (High Availability) ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рждрзЗ Health Check ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржЕржкрж░рж┐рж╣рж╛рж░рзНржпред ржПржЯрж┐ ржЖржкржирж╛рж░ рж╕рж┐рж╕рзНржЯрзЗржорзЗрж░ рж╕рзНржЯрзНржпрж╛ржмрж┐рж▓рж┐ржЯрж┐ ржмрж╛рзЬрж╛рждрзЗ ржПржмржВ ржорзНржпрж╛ржирзБрзЯрж╛рж▓ ржЗржирзНржЯрж╛рж░ржнрзЗржирж╢ржи ржХржорж╛рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗред

---

> [!TIP]
> ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗ ржПржХржЯрж┐ ржбрзЗржбрж┐ржХрзЗржЯрзЗржб `/health` ржмрж╛ `/status` ржПржирзНржбржкрзЯрзЗржирзНржЯ рждрзИрж░рж┐ ржХрж░рзБржи ржпрж╛ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржПржмржВ ржЕржирзНржпрж╛ржирзНржп рж╕рж╛рж░рзНржнрж┐рж╕рзЗрж░ ржЕржмрж╕рзНржерж╛ ржЪрзЗржХ ржХрж░рзЗ рж░рж┐ржЯрж╛рж░рзНржи ржХрж░ржмрзЗред
