# Multi-Stage Builds: ржЗржорзЗржЬрзЗрж░ рж╕рж╛ржЗржЬ ржХржорж╛ржирзЛрж░ ржорзНржпрж╛ржЬрж┐ржХ ЁЯкД

ржбржХрж╛рж░ ржЗржорзЗржЬ рждрзИрж░рж┐ ржХрж░рж╛рж░ рж╕ржорзЯ ржЖржорж╛ржжрзЗрж░ ржЕржирзЗржХ ржЯрзБрж▓рж╕ ржПржмржВ ржлрж╛ржЗрж▓ ржкрзНрж░рзЯрзЛржЬржи рж╣рзЯ (ржпрзЗржоржи: ржХржорзНржкрж╛ржЗрж▓рж╛рж░, рж╕рзЛрж░рзНрж╕ ржХрзЛржб, ржмрж┐рж▓рзНржб ржЯрзБрж▓рж╕)ред ржХрж┐ржирзНрждрзБ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи рж░рж╛ржи ржХрж░рж╛рж░ рж╕ржорзЯ ржПржЗ рж╕ржмржХрж┐ржЫрзБрж░ ржкрзНрж░рзЯрзЛржЬржи рж╣рзЯ ржирж╛ред **Multi-Stage Build** рж╣рж▓рзЛ ржПржоржи ржПржХржЯрж┐ ржкржжрзНржзрждрж┐ ржпрж╛рж░ ржорж╛ржзрзНржпржорзЗ ржЖржорж░рж╛ ржЗржорзЗржЬрзЗрж░ рж╕рж╛ржЗржЬ ржЕржирзЗржХ ржХржорж┐рзЯрзЗ ржЖржирждрзЗ ржкрж╛рж░рж┐ ржПржмржВ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ ржмрж╛рзЬрж╛рждрзЗ ржкрж╛рж░рж┐ред

---

## рзз. Multi-Stage Build ржХрж┐?

ржПржХржЯрж┐ ржорж╛рждрзНрж░ Dockerfile-ржП ржПржХрж╛ржзрж┐ржХ `FROM` ржЗржирзНрж╕ржЯрзНрж░рж╛ржХрж╢ржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ржХрзЗржЗ Multi-Stage Build ржмрж▓рж╛ рж╣рзЯред ржкрзНрж░рждрж┐ржЯрж┐ `FROM` ржПржХржЯрж┐ ржирждрзБржи **Stage** рж╢рзБрж░рзБ ржХрж░рзЗред ржЖржкржирж┐ ржПржХ рж╕рзНржЯрзЗржЬ ржерзЗржХрзЗ ржЕржирзНржп рж╕рзНржЯрзЗржЬрзЗ ржкрзНрж░рзЯрзЛржЬржирзАрзЯ ржлрж╛ржЗрж▓ ржХржкрж┐ ржХрж░рзЗ ржирж┐рзЯрзЗ ржЖрж╕рждрзЗ ржкрж╛рж░рзЗржи ржПржмржВ ржЕржкрзНрж░рзЯрзЛржЬржирзАрзЯ ржлрж╛ржЗрж▓ржЧрзБрж▓рзЛржХрзЗ ржкрзЗржЫржирзЗ ржлрзЗрж▓рзЗ ржЖрж╕рждрзЗ ржкрж╛рж░рзЗржиред

---

## рзи. ржХрзЗржи ржПржЯрж┐ ржкрзНрж░рзЯрзЛржЬржи? (ржЙржкржХрж╛рж░рж┐рждрж╛)

- **ржЗржорзЗржЬ рж╕рж╛ржЗржЬ ржХржорж╛ржирзЛ:** ржмрж┐рж▓рзНржб ржХрж░рж╛рж░ ржЯрзБрж▓рж╕ (ржпрзЗржоржи: 1GB-ржПрж░ SDK) ржмрж╛ржж ржжрж┐рзЯрзЗ рж╢рзБржзрзБржорж╛рждрзНрж░ ржЪрж╛рж▓рж╛ржирзЛрж░ ржЙржкржпрзЛржЧрзА ржлрж╛ржЗрж▓ (ржпрзЗржоржи: 10MB-ржПрж░ ржмрж╛ржЗржирж╛рж░рж┐) ржЗржорзЗржЬрзЗ рж░рж╛ржЦрж╛ рж╣рзЯред
- **рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐:** ржЗржорзЗржЬрзЗ ржпржд ржХржо ржлрж╛ржЗрж▓ ржерж╛ржХржмрзЗ, ржЕрзНржпрж╛ржЯрж╛ржХ рж╣ржУрзЯрж╛рж░ рж╕рзБржпрзЛржЧ рждржд ржХржо ржерж╛ржХржмрзЗред
- **ржмрж┐рж▓рзНржб ржЕржкрзНржЯрж┐ржорж╛ржЗржЬрзЗрж╢ржи:** ржмрж┐рж▓рзНржб ржПржмржВ рж░рж╛ржи-ржЯрж╛ржЗржо ржПржиржнрж╛рзЯрж░ржиржорзЗржирзНржЯ ржЖрж▓рж╛ржжрж╛ рж░рж╛ржЦрж╛ ржпрж╛рзЯред

---

## рзй. ржкрзНрж░рзНржпрж╛ржХржЯрж┐ржХрзНржпрж╛рж▓ ржЙржжрж╛рж╣рж░ржг (Node.js App)

ржирж┐ржЪрзЗ ржПржХржЯрж┐ ржЖржжрж░рзНрж╢ Multi-Stage Dockerfile ржжрзЗржЦрж╛ржирзЛ рж╣рж▓рзЛ:

```dockerfile
# рзз. ржмрж┐рж▓рзНржб рж╕рзНржЯрзЗржЬ (Build Stage)
FROM node:16 AS builder
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

# рзи. ржкрзНрж░рзЛржбрж╛ржХрж╢ржи рж╕рзНржЯрзЗржЬ (Production Stage)
FROM node:16-alpine
WORKDIR /app
# ржЖржЧрзЗрж░ рж╕рзНржЯрзЗржЬ (builder) ржерзЗржХрзЗ рж╢рзБржзрзБржорж╛рждрзНрж░ ржмрж┐рж▓рзНржб ржХрж░рж╛ ржлрж╛ржЗрж▓ ржХржкрж┐ ржХрж░рж╛
COPY --from=builder /app/dist ./dist
CMD ["node", "dist/index.js"]
```

### ржПржЦрж╛ржирзЗ ржХрж┐ ржШржЯржЫрзЗ?

- **`AS builder`**: ржкрзНрж░ржержо рж╕рзНржЯрзЗржЬржЯрж┐рж░ ржПржХржЯрж┐ ржирж╛ржо ржжрзЗржУрзЯрж╛ рж╣рзЯрзЗржЫрзЗ ржпрж╛рждрзЗ ржкрж░рзЗ ржПржЯрж┐ржХрзЗ рж░рзЗржлрж╛рж░ ржХрж░рж╛ ржпрж╛рзЯред
- **`COPY --from=builder`**: ржПржЯрж┐ржЗ ржЖрж╕рж▓ ржорзНржпрж╛ржЬрж┐ржХ! ржПржЯрж┐ ржЖржЧрзЗрж░ рж╕рзНржЯрзЗржЬ ржерзЗржХрзЗ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржлрж╛ржЗрж▓ ржмрж╛ ржлрзЛрж▓рзНржбрж╛рж░ ржирж┐рзЯрзЗ ржЖрж╕рзЗред
- **Alpine Base Image**: рж╕рзЗржХрзЗржирзНржб рж╕рзНржЯрзЗржЬрзЗ ржЫрзЛржЯ рж╕рж╛ржЗржЬрзЗрж░ `alpine` ржЗржорзЗржЬ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЗржорзЗржЬрзЗрж░ рж╕рж╛ржЗржЬ ржЖрж░ржУ ржХржорж┐рзЯрзЗ ржЖржирж╛ рж╣рзЯрзЗржЫрзЗред

---

## рзк. Single-Stage vs Multi-Stage

| ржлрж┐ржЪрж╛рж░        | Single-Stage                   | Multi-Stage                   |
| :----------- | :----------------------------- | :---------------------------- |
| **Size**     | ржЕржирзЗржХ ржмрзЬ (Large)                | ржЕрждрзНржпржирзНржд ржЫрзЛржЯ (Minimal)         |
| **Files**    | рж╕рзЛрж░рзНрж╕ ржХрзЛржб + ржмрж┐рж▓рзНржб ржЯрзБрж▓рж╕ рж╕ржм ржерж╛ржХрзЗ | рж╢рзБржзрзБржорж╛рждрзНрж░ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржлрж╛ржЗрж▓ ржерж╛ржХрзЗ |
| **Security** | ржХржо ржирж┐рж░рж╛ржкржж                      | ржмрзЗрж╢рж┐ ржирж┐рж░рж╛ржкржж                   |

---

> [!TIP]
> ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗрж░ ржЬржирзНржп ржЗржорзЗржЬ рждрзИрж░рж┐ ржХрж░рж╛рж░ рж╕ржорзЯ рж╕ржмрж╕ржорзЯ Multi-Stage ржкржжрзНржзрждрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржиред ржПржЯрж┐ ржЖржкржирж╛рж░ ржХрзНрж▓рж╛ржЙржб рж╕рзНржЯрзЛрж░рзЗржЬрзЗрж░ ржЦрж░ржЪ ржмрж╛ржБржЪрж╛ржмрзЗ ржПржмржВ ржбрзЗржкрзНрж▓рзЯржорзЗржирзНржЯ ржжрзНрж░рзБржд ржХрж░ржмрзЗред
