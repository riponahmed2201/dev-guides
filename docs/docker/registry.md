# Docker Registry ЁЯУж

ржЖржкржирж╛рж░ ржирж┐ржЬрзЗрж░ рждрзИрж░рж┐ ржХрж░рж╛ ржбржХрж╛рж░ ржЗржорзЗржЬржЧрзБрж▓рзЛ ржирж┐рж░рж╛ржкржжрзЗ рж╕рзНржЯрзЛрж░ ржХрж░рж╛рж░ ржПржмржВ ржорзНржпрж╛ржирзЗржЬ ржХрж░рж╛рж░ ржЬрж╛рзЯржЧрж╛ржЗ рж╣рж▓рзЛ **Docker Registry**ред ржбржХрж╛рж░ рж╣рж╛ржм (Docker Hub) рж╣рж▓рзЛ ржПржХржЯрж┐ ржкрж╛ржмрж▓рж┐ржХ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐, ржХрж┐ржирзНрждрзБ ржЕржирзЗржХ рж╕ржорзЯ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ ржмрж╛ ржкрзНрж░рж╛ржЗржнрзЗрж╕рж┐ ржХрж╛рж░ржгрзЗ ржЖржорж╛ржжрзЗрж░ ржирж┐ржЬрзЗржжрзЗрж░ ржПржХржЯрж┐ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐ ржкрзНрж░рзЯрзЛржЬржи рж╣рзЯред

---

## рзз. ржбржХрж╛рж░ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐ ржХрж┐?

ржбржХрж╛рж░ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐ рж╣рж▓рзЛ ржПржХржЯрж┐ рж╕рзНржЯрзЛрж░рзЗржЬ ржПржмржВ ржбрж┐рж╕рзНржЯрзНрж░рж┐ржмрж┐ржЙрж╢ржи рж╕рж┐рж╕рзНржЯрзЗржо ржпрж╛ ржбржХрж╛рж░ ржЗржорзЗржЬржЧрзБрж▓рзЛржХрзЗ рж╣рзЛрж╕рзНржЯ ржХрж░рзЗред ржЖржкржирж┐ ржПржЦрж╛ржи ржерзЗржХрзЗ ржЗржорзЗржЬ `push` ржмрж╛ `pull` ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

- **Public Registry:** ржбржХрж╛рж░ рж╣рж╛ржм (Docker Hub), ржХрзЛрзЯрж╛ржЗ (Quay.io)ред
- **Private Registry:** ржирж┐ржЬрзЗрж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗ рж╣рзЛрж╕рзНржЯ ржХрж░рж╛ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐ ржмрж╛ ржХрзНрж▓рж╛ржЙржб ржкрзНрж░ржнрж╛ржЗржбрж╛рж░ржжрзЗрж░ рж╕рж╛рж░рзНржнрж┐рж╕ (AWS ECR, Google Artifact Registry)ред

---

## рзи. ржкрзНрж░рж╛ржЗржнрзЗржЯ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐ рж╕рзЗржЯржЖржк (Setup)

ржбржХрж╛рж░ ржирж┐ржЬрзЗржЗ ржПржХржЯрж┐ ржЕржлрж┐рж╕рж┐рзЯрж╛рж▓ ржЗржорзЗржЬ ржкрзНрж░ржжрж╛ржи ржХрж░рзЗ ржпрж╛рж░ ржирж╛ржо `registry:2`ред ржПржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЦрзБржм рж╕рж╣ржЬрзЗржЗ ржПржХржЯрж┐ ржкрзНрж░рж╛ржЗржнрзЗржЯ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐ ржмрж╛ржирж╛ржирзЛ ржпрж╛рзЯред

```bash
# рж▓рзЛржХрж╛рж▓ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐ рж░рж╛ржи ржХрж░рж╛ (Port 5000 ржП)
docker run -d -p 5000:5000 --name my-registry registry:2
```

ржПржЦржи ржЖржкржирж┐ ржЖржкржирж╛рж░ ржЗржорзЗржЬржЯрж┐ржХрзЗ ржЯрзНржпрж╛ржЧ ржХрж░рзЗ ржПржЗ рж▓рзНржпрзЛржХрж╛рж▓ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐рждрзЗ ржкрзБрж╢ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи:

```bash
docker tag my-image:latest localhost:5000/my-image:latest
docker push localhost:5000/my-image:latest
```

---

## рзй. ржЕржерзЗржирзНржЯрж┐ржХрзЗрж╢ржи (Authentication)

ржбрж┐ржлрж▓рзНржЯржнрж╛ржмрзЗ ржкрзНрж░рж╛ржЗржнрзЗржЯ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐ ржХрзЛржирзЛ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржЫрж╛рзЬрж╛ржЗ рж░рж╛ржи ржХрж░рзЗ, ржпрж╛ рж╕рж┐ржХрж┐ржЙрж░ ржирзЯред ржЖржкржирж┐ **htpasswd** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржмрзЗрж╕рж┐ржХ ржЕржерзЗржирзНржЯрж┐ржХрзЗрж╢ржи ржпрзЛржЧ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

```bash
# ржЗржЙржЬрж╛рж░ ржПржмржВ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рждрзИрж░рж┐ ржХрж░рж╛
docker run --entrypoint htpasswd httpd:2.4 -Bbn myuser mypassword > auth/htpasswd
```

рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐ рж░рж╛ржи ржХрж░рж╛рж░ рж╕ржорзЯ ржПржЗ ржлрж╛ржЗрж▓ржЯрж┐ ржорж╛ржЙржирзНржЯ ржХрж░рзЗ ржжрж┐рждрзЗ рж╣ржмрзЗред

---

## рзк. TLS/SSL ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи

ржкрж╛ржмрж▓рж┐ржХ ржирзЗржЯржУрзЯрж╛рж░рзНржХрзЗ ржмрж╛ ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐ ржЪрж╛рж▓рж╛ржирзЛрж░ рж╕ржорзЯ ржЕржмрж╢рзНржпржЗ **HTTPS (SSL/TLS)** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ рж╣ржмрзЗред ржЕржирзНржпржерж╛рзЯ ржбржХрж╛рж░ ржХрзНрж▓рзНржпрж╛рзЯрзЗржирзНржЯ ржЗржорзЗржЬ ржкрзБрж╢ ржмрж╛ ржкрзБрж▓ ржХрж░рждрзЗ ржмрж╛ржзрж╛ ржжрзЗржмрзЗ (Insecure Registry error)ред

ржЖржкржирж╛ржХрзЗ ржЖржкржирж╛рж░ ржбрзЛржорзЗржЗржирзЗрж░ ржЬржирзНржп SSL рж╕рж╛рж░рзНржЯрж┐ржлрж┐ржХрзЗржЯ (ржпрзЗржоржи: Let's Encrypt) рж╕ржВржЧрзНрж░рж╣ ржХрж░рждрзЗ рж╣ржмрзЗ ржПржмржВ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐ ржХржирзНржЯрзЗржЗржирж╛рж░рзЗ ржорж╛ржЙржирзНржЯ ржХрж░рждрзЗ рж╣ржмрзЗред

---

## рзл. рж╕рзНржЯрзЛрж░рзЗржЬ ржмрзНржпрж╛ржХржПржирзНржб (Storage Backends)

рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐ ржбрж╛ржЯрж╛ ржХрзЛржерж╛рзЯ рж╕рзЗржЗржн ржХрж░ржмрзЗ рждрж╛ ржЖржкржирж┐ ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рждрзЗ ржкрж╛рж░рзЗржи:

- **Filesystem:** рж▓рзЛржХрж╛рж▓ ржбрж┐рж╕рзНржХрзЗ рж╕рзЗржЗржн рж╣ржмрзЗред
- **S3:** AWS S3 ржмрзНрж░рж╛ржХрзЗржЯрзЗ рж╕рзЗржЗржн рж╣ржмрзЗ (рж╕рзНржХрзЗрж▓рзНржпрж╛ржмрж▓ ржПржмржВ ржирж┐рж░рж╛ржкржж)ред
- **Azure Blob / GCS:** ржЕржирзНржпрж╛ржирзНржп ржХрзНрж▓рж╛ржЙржб рж╕рзНржЯрзЛрж░рзЗржЬрзЗржУ рж╕рзЗржЗржн ржХрж░рж╛ ржпрж╛рзЯред

---

## рзм. ржЧрж╛рж░ржмрзЗржЬ ржХрж╛рж▓рзЗржХрж╢ржи (Garbage Collection)

ржпржЦржи ржЖржкржирж┐ ржЕржирзЗржХ ржЗржорзЗржЬ ржбрж┐рж▓рж┐ржЯ ржХрж░рзЗржи, ржбржХрж╛рж░ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐ ржбрж┐рж╕рзНржХ ржерзЗржХрзЗ ржлрж╛ржЗрж▓ржЧрзБрж▓рзЛ рж╕рж░рж╛рж╕рж░рж┐ ржорзБржЫрзЗ ржлрзЗрж▓рзЗ ржирж╛ред ржбрж┐рж╕рзНржХрзЗрж░ ржЬрж╛рзЯржЧрж╛ ржЦрж╛рж▓рж┐ ржХрж░рж╛рж░ ржЬржирзНржп ржЖржкржирж╛ржХрзЗ ржЧрж╛рж░ржмрзЗржЬ ржХрж╛рж▓рзЗржХрж╢ржи ржХржорж╛ржирзНржбржЯрж┐ рж░рж╛ржи ржХрж░рждрзЗ рж╣рзЯред

```bash
docker exec registry bin/registry garbage-collect /etc/docker/registry/config.yml
```

---

## рзн. Registry API

ржбржХрж╛рж░ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐ ржПржХржЯрж┐ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА **REST API** ржкрзНрж░ржжрж╛ржи ржХрж░рзЗред ржПрж░ ржорж╛ржзрзНржпржорзЗ ржЖржкржирж┐ ржкрзНрж░рзЛржЧрзНрж░рж╛ржорзЗржЯрж┐ржХрж╛рж▓рж┐ ржЗржорзЗржЬ ржХрзБрзЯрзЗрж░рж┐ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи ржмрж╛ ржлрж╛ржЗрж▓ ржбрж┐рж▓рж┐ржЯ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

- `GET /v2/_catalog` - рж╕ржм ржЗржорзЗржЬрзЗрж░ рж▓рж┐рж╕рзНржЯ ржжрзЗржЦрждрзЗред
- `GET /v2/<name>/tags/list` - ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржЗржорзЗржЬрзЗрж░ ржЯрзНржпрж╛ржЧ ржжрзЗржЦрждрзЗред

---

## рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк (Summary)

ржкрзНрж░рж╛ржЗржнрзЗржЯ ржбржХрж╛рж░ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржмрзЬ ржЯрж┐ржорзЗрж░ ржЬржирзНржп ржЕрждрзНржпржирзНржд рж╕рзБржмрж┐ржзрж╛ржЬржиржХред ржПржЯрж┐ ржЖржкржирж╛рж░ ржХрзЛржорзНржкрж╛ржирж┐рж░ ржХрзЛржб ржПржмржВ ржЗржорзЗржЬржХрзЗ ржирж┐ржЬрзЗржжрзЗрж░ ржирж┐рзЯржирзНрждрзНрж░ржгрзЗ рж░рж╛ржЦрзЗ ржПржмржВ ржирзЗржЯржУрзЯрж╛рж░рзНржХ ржХрж╕рзНржЯ ржХржорж╛рзЯред

---

> [!IMPORTANT]
> ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗ ржкрзНрж░рж╛ржЗржнрзЗржЯ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рж┐ ржмрзНржпржмрж╣рж╛рж░рзЗрж░ рж╕ржорзЯ ржЕржмрж╢рзНржпржЗ рж░рж┐ржнрж╛рж░рзНрж╕ ржкрзНрж░ржХрзНрж╕рж┐ (ржпрзЗржоржи: Nginx) ржПржмржВ SSL ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржиред
