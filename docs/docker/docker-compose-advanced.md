# Docker Compose - Advanced: ржкрзНрж░ржлрзЗрж╢ржирж╛рж▓ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ЁЯЪА

ржбржХрж╛рж░ ржХржорзНржкрзЛржЬрзЗрж░ ржмрзЗрж╕рж┐ржХ ржЬрж╛ржирж╛рж░ ржкрж░, ржкрзНрж░рзЛржбрж╛ржХрж╢ржи рж▓рзЗржнрзЗрж▓рзЗ ржЕрзНржпрж╛ржк ржЪрж╛рж▓рж╛ржирзЛрж░ ржЬржирзНржп ржХрж┐ржЫрзБ ржЕрзНржпрж╛ржбржнрж╛ржирзНрж╕ржб ржлрж┐ржЪрж╛рж░рзЗрж░ ржкрзНрж░рзЯрзЛржЬржи рж╣рзЯред ржПржЗ ржЧрж╛ржЗржбрзЗ ржЖржорж░рж╛ рж╢рж┐ржЦржмрзЛ ржХрж┐ржнрж╛ржмрзЗ ржХржирзНржЯрзЗржЗржирж╛рж░рзЗрж░ рж░рж┐рж╕рзЛрж░рзНрж╕ ржХржирзНржЯрзНрж░рзЛрж▓ ржХрж░рж╛ ржпрж╛рзЯ, рж╣рзЗрж▓ржержЪрзЗржХ рж╕рзЗржЯржЖржк ржХрж░рж╛ ржпрж╛рзЯ ржПржмржВ ржкрзНрж░рзЛржлрж╛ржЗрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж╕рзНржорж╛рж░рзНржЯрж▓рж┐ ржХржирзНржЯрзЗржЗржирж╛рж░ ржорзНржпрж╛ржирзЗржЬ ржХрж░рж╛ ржпрж╛рзЯред

---

## рзз. рж╣рзЗрж▓ржержЪрзЗржХ (Healthcheck)

ржХржЦржирзЛ ржХржЦржирзЛ ржПржХржЯрж┐ ржХржирзНржЯрзЗржЗржирж╛рж░ "Running" ржжрзЗржЦрж╛рж▓рзЗржУ ржнрзЗрждрж░рзЗ рж╕рж╛рж░рзНржнрж┐рж╕ржЯрж┐ ржЖрж╕рж▓рзЗ рж░рзЗржбрж┐ ржерж╛ржХрзЗ ржирж╛ (ржпрзЗржоржи- ржбрж╛ржЯрж╛ржмрзЗрж╕ ржЪрж╛рж▓рзБ рж╣рждрзЗ рж╕ржорзЯ ржирзЗрзЯ)ред рж╣рзЗрж▓ржержЪрзЗржХ ржжрж┐рзЯрзЗ ржПржЯрж┐ ржЪрзЗржХ ржХрж░рж╛ ржпрж╛рзЯ:

```yaml
services:
  db:
    image: postgres
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5
```

---

## рзи. рж░рж┐рж╕рзЛрж░рзНрж╕ рж▓рж┐ржорж┐ржЯ (Resource Limits)

ржПржХржЯрж┐ ржХржирзНржЯрзЗржЗржирж╛рж░ ржпрзЗржи ржЖржкржирж╛рж░ ржкрзБрж░рзЛ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ рж╕ржм RAM ржмрж╛ CPU ржжржЦрж▓ ржХрж░рзЗ ржирж╛ ржирзЗрзЯ, рж╕рзЗржЬржирзНржп рж▓рж┐ржорж┐ржЯ рж╕рзЗржЯ ржХрж░рж╛ ржЬрж░рзБрж░рж┐:

```yaml
services:
  web:
    image: nginx
    deploy:
      resources:
        limits:
          cpus: '0.50'     # рж╕рж░рзНржмрзЛржЪрзНржЪ рзлрзж% CPU
          memory: 512M      # рж╕рж░рзНржмрзЛржЪрзНржЪ рзлрззрзи ржорзЗржЧрж╛ржмрж╛ржЗржЯ RAM
        reservations:
          memory: 128M      # ржорж┐ржирж┐ржорж╛ржо рззрзирзо ржорзЗржЧрж╛ржмрж╛ржЗржЯ рж░рж┐ржЬрж╛рж░рзНржн ржерж╛ржХржмрзЗ
```

---

## рзй. ржмрж┐рж▓рзНржб ржЖрж░рзНржЧрзБржорзЗржирзНржЯ (Build Arguments)

ржЗржорзЗржЬ ржмрж┐рж▓рзНржб ржХрж░рж╛рж░ рж╕ржорзЯ ржпржжрж┐ ржХрзЛржирзЛ ржнрзНржпрж╛рж░рж┐рзЯрзЗржмрж▓ ржкрж╛рж╕ ржХрж░рж╛рж░ ржжрж░ржХрж╛рж░ рж╣рзЯ (ржпрзЗржоржи- рж╕ржлржЯржУрзЯрзНржпрж╛рж░ ржнрж╛рж░рзНрж╕ржи):

```yaml
services:
  api:
    build:
      context: .
      args:
        - APP_VERSION=1.0.0
```

---

## рзк. ржПржХрзНрж╕ржЯрзЗржирзНржбрж╕ ржПржмржВ ржЗржирж╣рзЗрж░рж┐ржЯрзЗржирзНрж╕ (Extends)

ржПржХржЗ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржмрж╛рж░ржмрж╛рж░ ржирж╛ рж▓рж┐ржЦрзЗ ржПржХржЯрж┐ ржХржоржи ржЕржВрж╢ржХрзЗ ржЕржирзНржп рж╕рж╛рж░рзНржнрж┐рж╕рзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржпрж╛рзЯ:

```yaml
services:
  base:
    image: my-app
    environment:
      - NODE_ENV=production

  web:
    extends: base
    ports:
      - "80:80"
```

---

## рзл. ржкрзНрж░рзЛржлрж╛ржЗрж▓ (Profiles)

рж╕ржмрж╕ржорзЯ рж╕ржм ржХржирзНржЯрзЗржЗржирж╛рж░рзЗрж░ ржжрж░ржХрж╛рж░ рж╣рзЯ ржирж╛ред ржкрзНрж░рзЛржлрж╛ржЗрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЖржкржирж┐ ржмрзЗржЫрзЗ ржирж┐рждрзЗ ржкрж╛рж░рзЗржи ржХрзЛржиржЧрзБрж▓рзЛ ржЪрж╛рж▓рзБ рж╣ржмрзЗ:

```yaml
services:
  debug-tool:
    image: alpine
    profiles:
      - debug    # ржПржЯрж┐ рж╢рзБржзрзБ 'docker-compose --profile debug up' ржмрж▓рж▓рзЗржЗ ржЪрж▓ржмрзЗ
```

---

## рзм. ржПржбржнрж╛ржирзНрж╕ржб ржлрж┐ржЪрж╛рж░ рж╕рж╛ржорж╛рж░рж┐

| ржлрж┐ржЪрж╛рж░ | ржХрж╛ржЬ |
| :--- | :--- |
| **Depends On** | ржХржирзНржЯрзЗржЗржирж╛рж░рзЗрж░ рж╢рзБрж░рзБрж░ ржХрзНрж░ржо ржПржмржВ ржХржирзНржбрж┐рж╢ржи (ржпрзЗржоржи: healthy) ржарж┐ржХ ржХрж░рзЗ |
| **Healthcheck** | ржХржирзНржЯрзЗржЗржирж╛рж░рзЗрж░ ржнрзЗрждрж░рзЗ рж╕рж╛рж░рзНржнрж┐рж╕ржЯрж┐ рж╕ржЪрж▓ ржХрж┐ ржирж╛ рждрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ |
| **Resource Limits** | RAM ржПржмржВ CPU ржмрзНржпржмрж╣рж╛рж░ ржирж┐рзЯржирзНрждрзНрж░ржг ржХрж░рзЗ |
| **Build Args** | ржбржХрж╛рж░ржлрж╛ржЗрж▓рзЗ ржЗржорзЗржЬрзЗрж░ ржнрзЗрждрж░ ржбрж╛ржЗржирж╛ржорж┐ржХ ржбрзЗржЯрж╛ ржкрж╛ржарж╛рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗ |
| **Profiles** | рж╕рж╛рж░рзНржнрж┐рж╕ржЧрзБрж▓рзЛржХрзЗ ржмрж┐ржнрж┐ржирзНржи ржЧрзНрж░рзБржкрзЗ ржнрж╛ржЧ ржХрж░рзЗ ржкрзНрж░рзЯрзЛржЬржи ржЕржирзБржпрж╛рзЯрзА ржЪрж╛рж▓рж╛ржирзЛ |

---

> [!TIP]
> ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗ рж╕ржмрж╕ржорзЯ `Resource Limits` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред ржПржЯрж┐ ржЖржкржирж╛рж░ рж╕рж┐рж╕рзНржЯрзЗржоржХрзЗ рж╕рзНржЯрзНржпрж╛ржмрж▓ рж░рж╛ржЦрждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░ржмрзЗред