# Docker Compose - Services: рж╕рж╛рж░рзНржнрж┐рж╕рзЗрж░ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ЁЯЫая╕П

ржбржХрж╛рж░ ржХржорзНржкрзЛржЬ ржлрж╛ржЗрж▓рзЗрж░ рж╕ржмржЪрзЗрзЯрзЗ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржЕржВрж╢ рж╣рж▓рзЛ `services` ржмрзНрж▓ржХред ржПржЦрж╛ржирзЗ ржЖржорж░рж╛ ржкрзНрж░рждрж┐ржЯрж┐ ржХржирзНржЯрзЗржЗржирж╛рж░ржХрзЗ ржХрж┐ржнрж╛ржмрзЗ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рж╛ рж╣ржмрзЗ, рждрж╛ рж╕рзБржирж┐рж░рзНржжрж┐рж╖рзНржЯржнрж╛ржмрзЗ рж▓рж┐ржЦрзЗ ржерж╛ржХрж┐ред ржПржЗ ржЧрж╛ржЗржбрзЗ ржЖржорж░рж╛ рж╕рж╛рж░рзНржнрж┐рж╕рзЗрж░ ржмрж┐ржнрж┐ржирзНржи ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржЕржкрж╢ржиржЧрзБрж▓рзЛ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд рж╢рж┐ржЦржмрзЛред

---

## рзз. рж╕рж╛рж░рзНржнрж┐рж╕ ржбрзЗржлрж┐ржирж┐рж╢ржи (Service Definition)

ржкрзНрж░рждрж┐ржЯрж┐ ржХржирзНржЯрзЗржЗржирж╛рж░ржХрзЗ ржбржХрж╛рж░ ржХржорзНржкрзЛржЬрзЗрж░ ржнрж╛рж╖рж╛рзЯ ржПржХржЯрж┐ **Service** ржмрж▓рж╛ рж╣рзЯред ржПржХржЯрж┐ ржкрзНрж░ржЬрзЗржХрзНржЯрзЗ ржЕржирзЗржХржЧрзБрж▓рзЛ рж╕рж╛рж░рзНржнрж┐рж╕ ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗред

### ржХ) Building from Dockerfile

ржпржжрж┐ ржЖржкржирж╛рж░ ржЗржорзЗржЬржЯрж┐ ржХрж╛рж╕рзНржЯржо рж╣рзЯ ржПржмржВ рж╕рзЗржЯрж┐ ржмрж┐рж▓рзНржб ржХрж░рж╛рж░ ржкрзНрж░рзЯрзЛржЬржи ржкрзЬрзЗ:

```yaml
services:
  web:
    build: . # ржмрж░рзНрждржорж╛ржи ржбрж┐рж░рзЗржХрзНржЯрж░рж┐
    # ржЕржержмрж╛ ржлрзЛрж▓рзНржбрж╛рж░ рж╕рзНржкрзЗрж╕рж┐ржлрж┐ржХ ржнрж╛ржмрзЗ:
    # build: ./frontend
```

### ржЦ) Using Existing Images

ржбржХрж╛рж░ рж╣рж╛ржм ржерзЗржХрзЗ ржХрзЛржирзЛ ржкрзНрж░рж┐-ржмрж┐рж▓рзНржЯ ржЗржорзЗржЬ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржЪрж╛ржЗрж▓рзЗ:

```yaml
services:
  database:
    image: mysql:8.0
```

---

## рзи. ржкрзЛрж░рзНржЯ ржПржмржВ ржнрж▓рж┐ржЙржо ржорзНржпрж╛ржкрж┐ржВ

- **Port Mapping:** рж╣рзЛрж╕рзНржЯ ржорзЗрж╢рж┐ржирзЗрж░ ржкрзЛрж░рзНржЯрзЗрж░ рж╕рж╛ржерзЗ ржХржирзНржЯрзЗржЗржирж╛рж░ ржкрзЛрж░рзНржЯрзЗрж░ рж╕ржВржпрзЛржЧред

  ```yaml
  ports:
    - "8080:80" # рж╣рзЛрж╕рзНржЯ:ржХржирзНржЯрзЗржЗржирж╛рж░
  ```

- **Volume Mounting:** ржбрзЗржЯрж╛ ржбрзНрж░рж╛ржЗржн ржмрж╛ рж╣рзЛрж╕рзНржЯрзЗрж░ ржлрзЛрж▓рзНржбрж╛рж░ ржорж╛ржЙржирзНржЯ ржХрж░рж╛ред
  ```yaml
  volumes:
    - ./data:/app/data
    - db-storage:/var/lib/mysql
  ```

---

## рзй. ржПржиржнрж╛рзЯрж░ржиржорзЗржирзНржЯ ржнрзНржпрж╛рж░рж┐рзЯрзЗржмрж▓ (Environment Variables)

ржЕрзНржпрж╛ржкрзЗрж░ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржмрж╛ рж╕рж┐ржХрзНрж░рзЗржЯ ржХржирзНржЯрзЗржЗржирж╛рж░рзЗрж░ ржнрзЗрждрж░рзЗ ржкрж╛рж╕ ржХрж░рж╛рж░ ржжрзБржЯрж┐ ржкржжрзНржзрждрж┐ ржЖржЫрзЗ:

рзз. **рж╕рж░рж╛рж╕рж░рж┐ ржЙрж▓рзНрж▓рзЗржЦ ржХрж░рж╛:**

```yaml
environment:
  - DEBUG=true
  - DB_PASSWORD=secret
```

рзи. **ржлрж╛ржЗрж▓ ржерзЗржХрзЗ рж▓рзЛржб ржХрж░рж╛ (Best Practice):**

```yaml
env_file:
  - .env
```

---

## рзк. ржХржорж╛ржирзНржб ржУржнрж╛рж░рж░рж╛ржЗржб (Command Override)

ржбржХрж╛рж░ ржЗржорзЗржЬрзЗ ржбрж┐ржлрж▓рзНржЯржнрж╛ржмрзЗ ржпрзЗ ржХржорж╛ржирзНржб ржжрзЗржУрзЯрж╛ ржерж╛ржХрзЗ (`CMD`), ржЖржкржирж┐ ржЪрж╛ржЗрж▓рзЗ ржХржорзНржкрзЛржЬ ржлрж╛ржЗрж▓ ржерзЗржХрзЗ рждрж╛ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ ржкрж╛рж░рзЗржи:

```yaml
services:
  app:
    image: my-node-app
    command: npm run dev # ржбрж┐ржлрж▓рзНржЯ ржХржорж╛ржирзНржбрзЗрж░ ржУржкрж░ ржПржЯрж┐ ржХрж╛ржЬ ржХрж░ржмрзЗ
```

---

## рзл. рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржкрж▓рж┐рж╕рж┐ (Restart Policies)

ржХржирзНржЯрзЗржЗржирж╛рж░ ржХрзЛржирзЛ ржХрж╛рж░ржгрзЗ ржХрзНрж░рзНржпрж╛рж╢ ржХрж░рж▓рзЗ ржмрж╛ ржмржирзНржз рж╣рзЯрзЗ ржЧрзЗрж▓рзЗ ржПржЯрж┐ ржХрж┐ ржЕржЯрзЛ-рж╕рзНржЯрж╛рж░рзНржЯ рж╣ржмрзЗ ржХрж┐ ржирж╛, рждрж╛ ржПржЦрж╛ржи ржерзЗржХрзЗ ржарж┐ржХ ржХрж░рж╛ ржпрж╛рзЯ:

- `no`: ржЕржЯрзЛржорзЗржЯрж┐ржХ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ рж╣ржмрзЗ ржирж╛ (ржбрж┐ржлрж▓рзНржЯ)ред
- `always`: рж╕ржмрж╕ржорзЯ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ рж╣ржмрзЗред
- `on-failure`: ржпржжрж┐ ржПрж░рж░ рж╣рзЯрзЗ ржмржирзНржз рж╣рзЯ, рждржмрзЗржЗ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ рж╣ржмрзЗред
- `unless-stopped`: ржЗржЙржЬрж╛рж░ ржирж┐ржЬрзЗ ржорзНржпрж╛ржирзБрзЯрж╛рж▓рж┐ рж╕рзНржЯржк ржирж╛ ржХрж░рж╛ ржкрж░рзНржпржирзНржд ржЕржЯрзЛ-рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ рж╣ржмрзЗред

```yaml
services:
  db:
    image: postgres
    restart: always
```

---

## рзм. рж╕рж╛рж░рзНржнрж┐рж╕ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи рж╕рж╛ржорж╛рж░рж┐

| ржХрзА-ржУрзЯрж╛рж░рзНржб     | ржХрж╛ржЬ                                      |
| :------------ | :--------------------------------------- |
| `build`       | рж▓рзЛржХрж╛рж▓ ржбржХрж╛рж░ржлрж╛ржЗрж▓ ржерзЗржХрзЗ ржЗржорзЗржЬ рждрзИрж░рж┐ ржХрж░рзЗ        |
| `image`       | ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржЗржорзЗржЬ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ               |
| `ports`       | ржкрзЛрж░рзНржЯ ржорзНржпрж╛ржкрж┐ржВ рж╣рзНржпрж╛ржирзНржбрзЗрж▓ ржХрж░рзЗ              |
| `volumes`     | ржбрзЗржЯрж╛ ржкрж╛рж░рж╕рж┐рж╕рзНржЯрзЗржирзНрж╕ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ            |
| `environment` | ржХржирзНржЯрзЗржЗржирж╛рж░рзЗ ржнрзНржпрж╛рж░рж┐рзЯрзЗржмрж▓ рж╕рзЗржЯ ржХрж░рзЗ            |
| `restart`     | ржХржирзНржЯрзЗржЗржирж╛рж░рзЗрж░ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржмрж┐рж╣рзЗржнрж┐ржпрж╝рж╛рж░ ржарж┐ржХ ржХрж░рзЗ |

---

> [!TIP]
> ржпржЦржи ржЖржкржирж┐ `build` ржПржмржВ `image` ржжрзБржЯрзЛржЗ ржПржХрж╕рж╛ржерзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи, рждржЦржи ржбржХрж╛рж░ ржХржорзНржкрзЛржЬ ржмрж┐рж▓рзНржб ржХрж░рж╛ ржЗржорзЗржЬрзЗрж░ ржирж╛ржо рж╣рж┐рж╕рзЗржмрзЗ `image` ржЯрзНржпрж╛ржЧржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗред
