# Database & Storage (ডিপ ডাইভ)

সিস্টেম ডিজাইনে ডেটা কীভাবে স্টোর, রিট্রিভ এবং ম্যানেজ করা হয় তা অত্যন্ত গুরুত্বপূর্ণ। নিচে ডেটাবেসের কোর এবং অ্যাডভান্সড বিষয়গুলো নিয়ে আলোচনা করা হলো।

---

## ১. ACID ট্রানজ্যাকশন (ACID Transactions)

ডেটাবেসের প্রতিটি ট্রানজ্যাকশন ৪টি শর্ত পূরণ করতে হয়:

- **Atomicity:** ট্রানজ্যাকশনটি হয় পুরোপুরি সফল হবে অথবা কিছুই হবে না (All or Nothing)।
- **Consistency:** ট্রানজ্যাকশনের আগে ও পরে ডেটাবেস ভ্যালিড স্টেটে থাকবে।
- **Isolation:** একটি ট্রানজ্যাকশন অন্যটিকে প্রভাবিত করবে না।
- **Durability:** একবার ট্রানজ্যাকশন সফল হলে তা পাওয়ার কাট হলেও মুছবে না।

---

## ২. SQL বনাম NoSQL (SQL vs NoSQL)

| ফিচার       | SQL (Relational)        | NoSQL (Non-relational)                          |
| :---------- | :---------------------- | :---------------------------------------------- |
| **Schema**  | Fixed Schema            | Flexible Schema                                 |
| **Scaling** | Vertical                | Horizontal                                      |
| **Joints**  | Complex JOINs supported | Joins are difficult (Denormalization preferred) |
| **উদা:**    | PostgreSQL, MySQL       | MongoDB, Cassandra                              |

---

## ৩. অ্যাডভান্সড ডেটা স্ট্রাকচারস এবং ফিল্টারস

### ক. ব্লুম ফিল্টারস (Bloom Filters)

**থিওরি:** এটি একটি প্রবাবিলিস্টিক (Probabilistic) ডেটা স্ট্রাকচার যা দিয়ে দ্রুত চেক করা যায় কোনো এলিমেন্ট সেটে আছে কি না।

- এটি false positive দিতে পারে (বলতে পারে আছে কিন্তু নেই), কিন্তু false negative দেয় না (বললে নেই মানে ১০০% নেই)।
- **ব্যবহর:** ক্যাশ পেনিট্রেশন (Cache penetration) কমাতে এবং ডাটাবেস কুয়েরি অপ্টিমাইজ করতে।

### খ. কুয়াড ট্রি (Quad Tree)

**থিওরি:** এটি জিও-লোকেশন (Location based) ডেটা ট্র্যাক করার জন্য ব্যবহৃত হয়। একটি এরিয়াকে ৪টি ভাগে ভাগ করে সার্চ করা হয়।

- **ব্যবহর:** Uber বা Google Maps এ কাছাকাছি রাইডার বা রেস্টুরেন্ট খুঁজতে।

### গ. চেঞ্জ ডেটা ক্যাপচার (CDC)

**থিওরি:** ডাটাবেসে কোনো পরিবর্তন (Insert/Update/Delete) হলে তা সাথে সাথে অন্য সিস্টেমে (উদা: Search index বা Analytics DB) পাঠিয়ে দেওয়া।

---

## ৪. রেডিস (Redis) এবং এর ব্যবহার

রেডিস মূলত একটি ইন-মেমরি কি-ভ্যালু স্টোর।

- **Caching:** ডাটাবেসের লোড কমানোর জন্য।
- **Rate Limiting:** আইপি বা ইউজার ভিত্তিক রিকোয়েস্ট লিমিট করা।
- **Leaderboard:** গেমের রিয়েল-টাইম স্কোর ট্র্যাক করা।
- **Pub/Sub:** রিয়েল-টাইম নোটিফিকেশন সিস্টেম।

---

## ৫. PostgreSQL ইন্টারনাল আর্কিটেকচার

PostgreSQL একটি শক্তিশালী প্রসেস-বেসড (Process-based) ডাটাবেস।

- **Shared Buffer:** মেমরিতে ডেটা ক্যাশ করে রাখার জন্য।
- **WAL (Write Ahead Log):** যেকোনো পরিবর্তনের আগে এটি লগে লিখে রাখা হয় (Durability নিশ্চিত করতে)।
- **MVCC (Multi-Version Concurrency Control):** একই সময়ে রিড এবং রাইট লক ছাড়াই করার জন্য।

---

## ৬. কুয়েরি অপ্টিমাইজেশন (Query Optimization)

- **Indexing:** সঠিক কলামে ইনডেক্স ব্যবহার করা।
- **Explain Plan:** কুয়েরি কীভাবে রান হচ্ছে তা অ্যানালাইজ করা।
- **Avoid SELECT \*:** শুধুমাত্র প্রয়োজনীয় কলাম সিলেক্ট করা।
- **Denormalization:** রিড পারফরম্যান্স বাড়াতে জয়েন কমিয়ে আলাদা টেবিল রাখা।

## ৭. সিনারিও ভিত্তিক প্রশ্ন (Scenario-based Questions)

ইন্টারভিউতে ডাটাবেস এবং স্টোরেজ নিয়ে আপনাকে কিছু জটিল পরিস্থিতি দেওয়া হতে পারে:

### সিনারিও ১: "আপনি ১ লক্ষ ট্রাকের রিয়েল-টাইম লোকেশন ট্র্যাকিং সিস্টেম বানাচ্ছেন। কোন ডাটাবেস বেছে নেবেন?"

**সমাধান:**
লোকেশন ট্র্যাকিং হলো একটি **Write-heavy** টাস্ক এবং ডেটা টাইম-সিরিজ প্যাটার্ন ফলো করে।
১. এখানে **NoSQL ( উদা: Cassandra বা InfluxDB)** সেরা পছন্দ হবে কারণ এটি খুব দ্রুত প্রচুর রাইট রিকোয়েস্ট হ্যান্ডেল করতে পারে।
২. রিয়েল-টাইম সার্চিংয়ের জন্য **Redis Geo-spatial** ইনডেক্স ব্যবহার করব।

### সিনারিও ২: "আপনার SQL ডাটাবেস তার রাইট ক্যাপাসিটির শেষ সীমায় পৌঁছে গেছে। এখন আপনার উপায় কী?"

**সমাধান:**
১. **Database Sharding:** ডেটা ভাগ করে আলাদা আলাদা সার্ভারে রাখা।
২. **Write-through Cache:** রাইট করার সময় ক্যাশ ব্যবহার করা।
৩. **Vertical Scaling:** সার্ভারের ক্ষমতা বাড়ানো (তবে এটি একটি নির্দিষ্ট সীমা পর্যন্ত সম্ভব)।
৪. **Message Queuing:** রাইট রিকোয়েস্টগুলো কিউতে রেখে পরে ডাটাবেসে রাইট করা।

### সিনারিও ৩: "উবার বা গুগল ম্যাপস কীভাবে ১০০ মিলিসেকেন্ডের মধ্যে আমার কাছের ট্যাক্সি খুঁজে বের করে?"

**সমাধান:**
১. এখানে **Quad Tree** বা **Google S2 Library** ব্যবহার করা হয়।
২. পুরো পৃথিবীকে ছোট ছোট গ্রিডে ভাগ করা হয়। যখন কোনো রিকোয়েস্ট আসে, তখন পুরো ডাটাবেস সার্চ না করে শুধুমাত্র ইউজারের বর্তমান গ্রিড এবং পাশের গ্রিডগুলো সার্চ করা হয়, যা ল্যাটেন্সি অনেক কমিয়ে দেয়।

---

> [!TIP]
> ডিস্ট্রিবিউটেড ডাটাবেসের ক্ষেত্রে **LSM (Log-Structured Merge-tree)** এবং **B-Tree** এর পার্থক্য বোঝা খুবই জরুরি। LSM রাইট মেক্সিমাইজড সিস্টেমের (উদা: Cassandra) জন্য ভালো এবং B-Tree রিড ইন্টারসেভ সিস্টেমের (উদা: PostgreSQL) জন্য ভালো।
